# Optimized Near‑Field Beamforming Simulator

An optimized near‑field beamforming simulator for LIS–UAV systems with a desktop GUI. It lets you explore AAG/AMAG behavior across near‑field and far‑field strategies, run wideband analyses, and evaluate spherical codebooks — all with performance‑oriented implementations designed for large scenarios.

- Desktop GUI for running AAG/AMAG experiments and visualizing results
- Supports very large scenarios (up to 1000 users)
- Presets for 5G/6G/7G‑style operating points (sub‑6 GHz, mmWave, sub‑THz, THz)
- High‑performance vectorization, parallel processing, and memory optimization
- Grey Wolf Optimizer (GWO) hooks are present but disabled by default to keep runs fast; enable only when needed

> Explore deeper technical notes in `docs/` (e.g., `optimized_nearfield_system_functions.md`).


## Installation

Prerequisites
- Python ≥ 3.9
- Recommended RAM: 8 GB or more for large runs

Setup
```bash
# 1) Clone
git clone <this-repo-url>
cd <repo>

# 2) Create & activate a virtual environment
python -m venv venv
# Windows PowerShell
venv\Scripts\Activate.ps1
# macOS/Linux (bash/zsh)
# source venv/bin/activate

# 3) Install dependencies
pip install -U pip
pip install -r requirements.txt
```


## Getting Started with the GUI

Launch the desktop GUI:
```bash
python main_simulation_gui.py
```

The window has three tabs:
- Activity: streaming logs and status updates
- Plots: figures generated by simulations and experiments (scrollable)
- Summary: textual metrics and run summaries

Left panel controls
- Preset: choose a hardware/frequency preset — e.g. `standard`, `5g_sub6`, `5g_mmwave`, `6g_subthz`, `7g_thz`, `large_array`, `small_test`.
- Mode: scenario size and depth — `standard`, `comprehensive`, `massive` (and a quick `fast` mode). Modes tune users/z‑points/realizations for runtime vs. fidelity.
- Users: override the mode’s default by supplying a single user count.
- Randomize on Run: pick a valid preset/mode/users at run time.
- Use JSON profile: toggle profile‑based configuration and select a profile from `config/simulation_configs.json`.

Advanced Overrides
- z‑range: `z_min`, `z_max` and number of z points
- x/y ranges: lateral user placement
- realizations per z: Monte‑Carlo repetitions
- n_jobs: parallel workers (`-1` uses all cores)

Experiments (advanced)
- Build Spherical Codebook: generate near‑field steering vectors over an `(r, θ, φ)` grid.
- Evaluate Codebook Mismatch: histogram quantization vs. ideal focusing; optional far‑field comparison.
- Wideband: TTD vs Phase: compare frequency‑flat phase shifters vs. per‑element true‑time‑delay across band.
- Advanced AAG/AMAG Maps: interactive angular/radial maps with ideal or codebook‑selected weights.
- Optimizer (optional): GWO can be enabled here to optimize phase‑only weights for wideband objectives. It is OFF by default to keep runs fast.

Note: some experiments are research‑oriented and may evolve.


## Running Simulations

For an end‑to‑end run, check “Complete Simulation (AAG/AMAG)” and click Run. Figures appear in Plots; textual metrics appear in Summary.

Tips for large runs
- Use presets like `5g_mmwave` or `6g_subthz` with `massive` mode.
- Set users to 500–1000 for stress tests, but expect longer runtimes.
- On constrained machines, reduce `num_realizations` or the number of z‑points.
- Heavy runs are cancellable via the “Cancel Run” button; prefer cancelling before closing the window.


## Using JSON Profiles

Profiles live in `config/simulation_configs.json`. Example (includes randomized ranges/choices):
```json
{
  "randomized_quick": {
    "description": "Quick randomized ranges for ad-hoc runs",
    "randomize": true,
    "seed": null,
    "users_choices": [1, 3, 5, 8, 10, 15, 20, 30, 50],
    "z_min_range": [0.1, 20.0],
    "z_max_range": [80.0, 200.0],
    "num_z_points_choices": [10, 12, 15, 20, 24, 30],
    "num_realizations_choices": [10, 20, 30, 50, 80, 100],
    "x_range": [-10, 10],
    "y_range": [-10, 10],
    "n_jobs": -1
  }
}
```
To use a profile in the GUI, check “Use JSON profile”, select a name (e.g. `randomized_quick`), and Run.


## Running from Code

Basic usage
```python
from optimized_nearfield_system import create_system_with_presets, create_simulation_config

# System preset and scenario mode
sim = create_system_with_presets("5g_mmwave")
cfg = create_simulation_config("massive")

# Override users for a single-scenario sweep
cfg.num_users_list = [1000]

# Run and save plots
results = sim.run_optimized_simulation(cfg)
sim.plot_comprehensive_results(results, save_dir="my_results")
```

Using JSON profiles
```python
from config_loader import ConfigManager
from optimized_nearfield_system import create_system_with_presets

cm = ConfigManager()
# Choose any preset; JSON profile controls the simulation config
sim = create_system_with_presets("standard")

cfg = cm.get_simulation_config("randomized_quick")
results = sim.run_optimized_simulation(cfg)
sim.plot_comprehensive_results(results, save_dir="my_results")
```

Optional optimizer (advanced)
- GWO hooks exist for phase‑only wideband objectives (e.g., maximizing average gain or minimizing flatness).
- It is disabled by default to maximize throughput; enable in the GUI under “Optimizer (optional)” when experimenting.


## Modules & Functions (Overview)

Core (high‑level)
- SystemParameters: LIS size, wavelength, frequency; derives inter‑element spacing.
- SimulationConfig: users, z‑values, realizations, lateral ranges, parallelism defaults.
- OptimizedNearFieldBeamformingSimulator: initializes system state, precomputes element positions, and provides optimized methods for:
  - Array gain, AAG/AMAG
  - Far‑field, average‑phase, and grouped beamforming
  - Path loss, SINR, and fully parallel simulation sweeps
- Helpers: `create_system_with_presets(preset)`, `create_simulation_config(mode)` streamline setup for common scenarios, including very large runs (up to 1000 users).

Advanced & research modules
- Spherical codebook build/evaluation and wideband TTD vs Phase experiments are available from the GUI’s “Experiments (advanced)” section.
- Optional optimizer (GWO) is wired into the wideband experiment with a strategy switch (default OFF).
- NOMA/RSMA enhanced simulators are included as optional research extensions for future work.

See `docs/optimized_nearfield_system_functions.md` and `docs/api_reference.md` for detailed API notes.


## Advanced Features & Extensions

- Grey Wolf Optimizer (GWO): present via hooks (default OFF) to avoid slowing routine runs. Enable in the GUI under “Optimizer (optional) → Use GWO optimizer” and select target/objective.
- JSON profiles: define fixed or randomized scenarios; the loader accepts comments/trailing commas for convenience.
- Wideband analyses: compare phase‑shifter vs TTD designs across subcarriers, plot gain spectra and flatness.
- Interactive AAG/AMAG maps: export Plotly HTML for angular heatmaps and radial slices.


## Troubleshooting & Tips

- Ensure dependencies are installed in an active virtual environment.
- On low‑spec machines, reduce realizations or the number of z points; prefer `fast` or `standard` modes.
- Large figures are scrollable in the Plots tab (use both scrollbars).
- Use “Cancel Run” to safely stop heavy runs before closing the window.
- Windows: Tkinter ships with the official Python installer; ensure you are using a standard Python build.


## A note on performance & GWO

The simulator emphasizes vectorization, parallel processing, and memory efficiency to handle large sweeps. While GWO can find improved phase‑only solutions for specific objectives, it is disabled by default to keep computations fast during routine exploration. Turn it on only for targeted optimization studies.
